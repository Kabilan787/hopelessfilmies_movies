@{
    ViewData["Title"] = "Details";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
@using HopelessFilmiesMVC.Data
@model dynamic

<link rel="stylesheet" href="~/css/details.css" asp-append-version="true" />

<section class="short-films-section">
    <div class="film-details-container">

        <h2>@Model.Heading</h2>

        <img src="@Model.Image" alt="@Model.Heading" class="film-detail-image"
             onerror="this.onerror=null;this.src='https://placehold.co/640x360/000000/FFFFFF?text=No+Image';" />

        <p><strong>Description:</strong> @Model.Description</p>
        <p><strong>Language:</strong> @Model.Language</p>
        <p><strong>Year:</strong> @Model.Year</p>
        <p><strong>Genre:</strong> @string.Join(", ", Model.Genre)</p>

        @* Optional fields with type check *@
        @if (Model is Film film)
        {
            if (!string.IsNullOrWhiteSpace(film.Writer))
            {
                <p><strong>Writer:</strong> @film.Writer</p>
            }
            if (!string.IsNullOrWhiteSpace(film.Director))
            {
                <p><strong>Director:</strong> @film.Director</p>
            }
            if (film.Stars != null && film.Stars.Any())
            {
                <p><strong>Stars:</strong> @string.Join(", ", film.Stars)</p>
            }
        }
        else if (Model is Podcast podcast)
        {
            if (!string.IsNullOrWhiteSpace(podcast.Host))
            {
                <p><strong>Host:</strong> @podcast.Host</p>
            }
            if (podcast.Guests != null && podcast.Guests.Any())
            {
                <p><strong>Guests:</strong> @string.Join(", ", podcast.Guests)</p>
            }
        }

        @{
            string buttonLabel = Model is Podcast ? "Listen Now" : "Watch Now";
            bool isUserSignedIn = User.Identity.IsAuthenticated;
            var link = Model.Link;
        }

        <a class="btn btn-primary protected-media-link"
           href="@link"
           data-link="@link"
           data-signed-in="@isUserSignedIn.ToString().ToLower()"
           target="_blank">
            @buttonLabel
        </a>


        <br />
        <a class="btn btn-secondary mt-3" href="/">← Back to Home</a>
    </div>

</section>
