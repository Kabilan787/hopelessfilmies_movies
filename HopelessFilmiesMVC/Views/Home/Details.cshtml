@{
    ViewData["Title"] = "Details";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
@using HopelessFilmies.Domain.Models
@model dynamic

<link rel="stylesheet" href="~/css/details.css" asp-append-version="true" />

<section class="short-films-section">
    <div class="film-details-container">

        <h2>@Model.Heading</h2>

        <img src="@Model.Image" alt="@Model.Heading" class="film-detail-image"
             onerror="this.onerror=null;this.src='https://placehold.co/640x360/000000/FFFFFF?text=No+Image';" />

        <p><strong>Description:</strong> @Model.Description</p>
        <p><strong>Language:</strong> @Model.Language</p>
        <p><strong>Year:</strong> @Model.Year</p>
        <p><strong>Genre:</strong> @string.Join(", ", Model.Genre)</p>

        @* Film-specific *@
        @if (Model is Film film)
        {
            if (!string.IsNullOrWhiteSpace(film.Writer))
            {
                <p><strong>Writer:</strong> @film.Writer</p>
            }
            if (!string.IsNullOrWhiteSpace(film.Director))
            {
                <p><strong>Director:</strong> @film.Director</p>
            }
            if (film.Stars?.Any() == true)
            {
                <p><strong>Stars:</strong> @string.Join(", ", film.Stars)</p>
            }
        }

        @* Podcast-specific *@
        else if (Model is Podcast podcast)
        {
            if (!string.IsNullOrWhiteSpace(podcast.Host))
            {
                <p><strong>Host:</strong> @podcast.Host</p>
            }
            if (podcast.Guests?.Any() == true)
            {
                <p><strong>Guests:</strong> @string.Join(", ", podcast.Guests)</p>
            }
        }

        @* Access ViewBag values *@
        @if (ViewBag.IsExclusive == true)
        {
            if (ViewBag.IsUserSignedIn != true)
            {
                <p class="text-danger fw-bold">Please sign in to watch this exclusive movie.</p>
            }
            else if (ViewBag.IsPurchased != true)
            {
                <p class="text-warning fw-bold">Buy this movie to watch it.</p>
            }
            else
            {
                <a class="btn btn-primary protected-media-link"
                   href="@ViewBag.Link"
                   data-link="@ViewBag.Link"
                   data-signed-in="true"
                   target="_blank">
                    @ViewBag.ButtonLabel
                </a>
            }
        }
        else
        {
            <a class="btn btn-primary protected-media-link"
               href="@ViewBag.Link"
               data-link="@ViewBag.Link"
               data-signed-in="@(ViewBag.IsUserSignedIn.ToString().ToLower())"
               target="_blank">
                @ViewBag.ButtonLabel
            </a>
        }

        <br />
        <a class="btn btn-secondary mt-3" href="/">← Back to Home</a>
    </div>
</section>
